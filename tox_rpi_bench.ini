[tox]
skipsdist = True
envlist = py39, py310, py311, pylint

[testenv]
commands = coverage run --source=rpi_bench --omit=*__init__.py,rpi_bench/test_collections/*,rpi_bench/system/* -m pytest tests -v --color=yes --html=tests/reports/{envname}/pytest.html
    coverage html -d tests/reports/{envname}/coverage
    coverage report --fail-under=3
deps =
    -rtests/requirements.txt
    -rrpi_bench/system/requirements.txt
    coverage

[testenv:pylint]
deps =
    pylint
    pylint-json2html
    -rtests/requirements.txt
    -rrpi_bench/system/requirements.txt
    -rrpi_bench/test_collections/accm/requirements.txt
    -rrpi_bench/test_collections/cosma/requirements.txt
    -rrpi_bench/test_collections/fcs/requirements.txt
commands =
    python -c "import os; os.makedirs('tests/reports', exist_ok=True)"
    pylint rpi_bench/ --output-format=json:tests/reports/pylint.json,colorized --fail-under=7
    pylint-json2html -o tests/reports/pylint.html tests/reports/pylint.json
